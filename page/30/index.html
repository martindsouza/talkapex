<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>TalkApex</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="TalkApex">
<meta property="og:url" content="http://www.talkapex.com/page/30/index.html">
<meta property="og:site_name" content="TalkApex">
<meta property="article:author" content="Martin Giffy D&#39;Souza">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@martindsouza">
  
    <link rel="alternate" href="/atom.xml" title="TalkApex" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <!-- <div id="banner"></div> -->
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <img src="/images/header-banner.png" alt="" />
      <!-- <h1 id="logo-wrap">
        <a href="/" id="logo">TalkApex</a>
      </h1> -->
      <!-- 
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Martin Giffy D&#39;Souza on Oracle APEX</a>
        </h2>
       -->
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.talkapex.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-enhancing-apex-security" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/05/enhancing-apex-security/" class="article-date">
  <time datetime="2009-05-11T13:27:00.000Z" itemprop="datePublished">2009-05-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/05/enhancing-apex-security/">Enhancing APEX Security</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><span style="font-style:italic;color:red;">Note: Full explanation available <a href="http://apex-smb.blogspot.com/2009/05/enhancing-apex-security-explanation.html" target="_blank" rel="noopener">here</a>. Please read before continuing with this post.</span></p>
<p>The best way to secure data in your APEX application, or any application, is to secure your data in the database. You can do this using Oracle’s Virtual Private Database (VPD), also known as Fine Grained Access Control (FGAC). APEX also has Session State Protection (SSP) which helps prevent front-end modification of data by preventing URL tampering.</p>
<p>I’m a big advocate of using both VPD and SSP. In some situations VPD may not be implemented for various reasons so developers must rely on SSP. SSP is great and allows developers to quickly and easily help prevent malicious users from trying to access data that they aren’t supposed to. It’s important to note that SSP only prevents URL tampering. If users wanted to alter data on a form they could easily do that with Firebug (I won’t go into that in this post). SSP also prevents users from setting values using AJAX. This can be circumvented using the “x01” .. “x10” parameters (please see Carl’s <a href="http://carlback.blogspot.com/2008/03/new-stuff-2-x01-and-friends.html" target="_blank" rel="noopener">post</a> for more info) but still leaves the door open for users to alter items in session state that they shouldn’t.</p>
<p>How can you use SSP, make AJAX calls, and ensure that users aren’t altering data on a form? This question has been bugging me for a while and I think I’ve come up with a solution that should work with minimal changes to existing code. For this example I’m going to use a select list containing a list of IDs (this is where the issue has come up the most for me). I’ll use the emp table, with empno as the id, for this example.</p>
<p>Some notation before we begin: “Secure” items (i.e. ones that have a hashed value appended to them) will be called PX_ITEM_NAME_SEC while it’s corresponding unsecured item is called PX_ITEM_NAME. The code only looks at “secure” items that have a matching “unsecured” item. “Unsecure” items are really items that are Hidden and Protected so they have a checksum associated to them.</p>
<p>The demo can be found <a href="http://apex.oracle.com/pls/otn/f?p=20195:1500" target="_blank" rel="noopener">here</a></p>
<p><span style="font-weight:bold;">Step 1- Compile Package</span></p>
<p><span style="font-style:italic">Since I don’t have access to DMBS_CRYPTO on apex.oracle.com I’ve used a dummy encryption method.</span> You’ll need to grant execute on DBMS_CRYPTO from SYS:</p>
<pre class="brush: sql">
GRANT EXECUTE ON DBMS_CRYPTO TO giffy; -- Where "giffy" is your schema name
</pre>

<p>Compile the following code in your schema</p>
<p><span style="font-style:italic;">pkg_apex_sec.pks</span></p>
<pre class="brush: sql">
CREATE OR REPLACE PACKAGE pkg_apex_sec
AS
  /**
   * Returns secure value
   * @param p_value
   * @return
   */
  FUNCTION f_get_sec_val (
    p_value IN VARCHAR2
  )
    RETURN VARCHAR2;

  /**
   * Checks if secured value is valid
   * @param p_hashed_val (case sensitive
   * @return 'Y' or 'N'
   */
  FUNCTION is_valid_hashed_val (
    p_hash IN VARCHAR2
  )
    RETURN VARCHAR2;

  /**
   * unsecure value given the hash
   * @param p_hash
   * @return unsecure number
   */
  FUNCTION f_get_val (
    p_hash IN VARCHAR2
  )
    RETURN VARCHAR2;

   /**
  * Sets unsec values in the page given the secure values
  * @param p_page_id Page ID to set. Default current page
  */
  PROCEDURE sp_set_page_unsec_values (
    p_page_id IN apex_application_pages.page_id%TYPE DEFAULT v ('APP_PAGE_ID')
  );

  /**
   * Set all the secure values given the unsecure values
   * @param p_page_id Page ID. Default current page
   */
  PROCEDURE sp_set_page_sec_values (
    p_page_id IN apex_application_pages.page_id%TYPE DEFAULT v ('APP_PAGE_ID')
  );
END pkg_apex_sec;
</pre>

<p><span style="font-style:italic;">pkg_apex_sec.pkb</span></p>
<pre class="brush: sql">
CREATE OR REPLACE PACKAGE BODY pkg_apex_sec
AS
  -- Constants
  gc_delim CONSTANT VARCHAR2 (1) := '@';

/**
 * Returns hashed value
 * May require sys to grant access to dbms_crypto
 *  - GRANT EXECUTE ON DBMS_CRYPTO TO <schema>;
 * @param p_source
 * @param p_key
 * @return hashed value
 */
  FUNCTION f_get_md5 (
    p_source IN VARCHAR2,
    p_key IN VARCHAR2
  )
    RETURN VARCHAR2
  IS
    v_key VARCHAR2 (4000) := p_key;
  BEGIN
    -- Normally your key should be different from the source. (this is up to you to maintain)
    -- For simplicity this function will see if they are the same. If so we'll append the app_id
    IF p_source = p_key THEN
      v_key := p_key || v ('APP_ID');
    END IF;

    -- Can't use DBMS_CRYPTO in apex.oracle.com. Using generic coding
    -- RETURN DBMS_CRYPTO.mac (src => UTL_RAW.cast_to_raw (p_source), typ => 2, KEY => UTL_RAW.cast_to_raw (v_key));
    RETURN p_source || p_key || 123;                                                                     -- DELETE THIS.
  END f_get_md5;

/**
 * Returns secure value
 * @param p_value
 * @return
 */
  FUNCTION f_get_sec_val (
    p_value IN VARCHAR2
  )
    RETURN VARCHAR2
  AS
  BEGIN
    -- For the Key value I'm arbitrarily appending the app id. You should change this to something that is secure to your code.
    -- You can add :app_session as well, provided you're not using session 0 or external links (ie. from emails etc)
    RETURN p_value || gc_delim || f_get_md5 (p_source => p_value, p_key => p_value || v ('APP_ID'));
  END f_get_sec_val;

  /**
   * Checks if secured value is valid
   * @param p_hashed_val (case sensitive
   * @return 'Y' or 'N'
   */
  FUNCTION is_valid_hashed_val (
    p_hash IN VARCHAR2
  )
    RETURN VARCHAR2
  AS
    v_value VARCHAR2 (4000);
  BEGIN
    v_value := REPLACE (REGEXP_SUBSTR (p_hash, '^[[:print:]]+' || gc_delim), gc_delim);

    IF p_hash = f_get_sec_val (p_value => v_value) THEN
      RETURN 'Y';
    ELSE
      RETURN 'N';
    END IF;
  EXCEPTION
    WHEN OTHERS THEN
      RETURN 'N';
  END is_valid_hashed_val;

  /**
   * unsecure value given the hash
   * @param p_hash
   * @return unsecure number
   */
  FUNCTION f_get_val (
    p_hash IN VARCHAR2
  )
    RETURN VARCHAR2
  AS
  BEGIN
    IF is_valid_hashed_val (p_hash => p_hash) = 'N' THEN
      RETURN NULL;
    END IF;

    RETURN (REPLACE (REGEXP_SUBSTR (p_hash, '^[[:print:]]+' || gc_delim), gc_delim));
  EXCEPTION
    WHEN OTHERS THEN
      RETURN NULL;
  END f_get_val;

  /**
   * Sets unsec values in the page given the secure values
   * @param p_page_id Page ID to set. Default current page
   */
  PROCEDURE sp_set_page_unsec_values (
    p_page_id IN apex_application_pages.page_id%TYPE DEFAULT v ('APP_PAGE_ID')
  )
  AS
    v_app_id apex_applications.application_id%TYPE := v ('APP_ID');
  BEGIN
    BEGIN
      -- Set all the unsecure values from the secure values
      FOR x IN (SELECT a1.item_name item_name_sec,
                       a2.item_name
                  FROM apex_application_page_items a1,
                       apex_application_page_items a2
                 WHERE a1.application_id = v_app_id
                   AND a1.page_id = p_page_id
                   AND a1.item_name LIKE '%_SEC'
                   -- Find corresponding item name
                   AND a2.application_id = a1.application_id
                   AND a2.page_id = a1.page_id
                   AND RTRIM (a1.item_name, '_SEC') = a2.item_name) LOOP
        apex_util.set_session_state (x.item_name, pkg_apex_sec.f_get_val (v (x.item_name_sec)));
      END LOOP;
    END;
  END sp_set_page_unsec_values;

  /**
   * Set all the secure values given the unsecure values
   * @param p_page_id Page ID. Default current page
   */
  PROCEDURE sp_set_page_sec_values (
    p_page_id IN apex_application_pages.page_id%TYPE DEFAULT v ('APP_PAGE_ID')
  )
  AS
    v_app_id apex_applications.application_id%TYPE := v ('APP_ID');
  BEGIN
    -- Set all the secure values from the secure values
    FOR x IN (SELECT a1.item_name item_name_sec,
                     a2.item_name
                FROM apex_application_page_items a1,
                     apex_application_page_items a2
               WHERE a1.application_id = v_app_id
                 AND a1.page_id = p_page_id
                 AND a1.item_name LIKE '%_SEC'
                 -- Find corresponding item name
                 AND a2.application_id = a1.application_id
                 AND a2.page_id = a1.page_id
                 AND RTRIM (a1.item_name, '_SEC') = a2.item_name) LOOP
      IF v (x.item_name) IS NOT NULL THEN
        apex_util.set_session_state (x.item_name_sec, pkg_apex_sec.f_get_sec_val (v (x.item_name)));
      END IF;
    END LOOP;
  END sp_set_page_sec_values;
END pkg_apex_sec;
</pre>

<p><span style="font-weight:bold;">Step 2- Create Application Processes</span></p>
<p>Create Application Processes (On Load Before Header) called: AP_SET_SEC_PAGE_ITEMS. This will allow you to pass IDs in the URL as you normally would.</p>
<pre class="brush: sql">
BEGIN
  pkg_apex_sec.sp_set_page_sec_values;
END;
</pre>

<p>Create Application Processes (On Submit and Before Computation ) called: AP_SET_UNSEC_PAGE_ITEMS</p>
<pre class="brush: sql">
BEGIN
  pkg_apex_sec.sp_set_page_unsec_values;
END;
</pre>

<p>Create Application Process (On Demand) called AP_NULL to set values in session (using AJAX).</p>
<pre class="brush: sql">
BEGIN
  pkg_apex_sec.sp_set_page_unsec_values; -- Update the unsec values from secure values for the current page
  NULL;
END;
</pre>

<p><span style="font-weight:bold;">Step 3 - Create page with Interactive Report (IR)</span></p>
<pre class="brush: sql">
SELECT *
  FROM emp
 WHERE empno = NVL (:p1500_empno, empno)
</pre>

<p><span style="font-weight:bold;">Step 4 - Create “Secure” Id LOV and a “Hidden and Protected” unsecured fields</span></p>
<p>Create P1500_EMPNO as Hidden and Protected. It’s extremely important that you make the field Hidden and Protected so users can’t alter the value in the form.<br>Create P1500_EMPNO_SEC as a Select List. LOV:</p>
<p>Instead of:</p>
<pre class="brush: sql">
SELECT e.ename d,
       e.empno r
  FROM emp e
</pre>  

<p>Use:</p>
<pre class="brush: sql">
SELECT e.ename d,
       pkg_apex_sec.f_get_sec_val (e.empno) r
  FROM emp e
</pre>  

<p><span style="font-style:italic;color:red">Besides adding the application processes etc, this is the only significant change that you’ll need to make to your application</span></p>
<p>At this point your application is good to go. Steps 5 and 6 are included only for demonstration purposes.</p>
<p><span style="font-weight:bold;">Step 5 - JavaScript</span><br>This JavaScript will be used to simulate the onChange event for a select list</p>
<pre class="brush: js">
function onLovChange(pThisId){
  var get = new htmldb_Get(null,$v('pFlowId'),'APPLICATION_PROCESS=AP_NULL',$v('pFlowStepId'));  
  get.add(pThisId, $v(pThisId));
  vReturn = get.get();  
}
</pre>

<p><span style="font-weight:bold;">Step 6 - Button </span><br>Create a Submit button that will submit and branch to the same page. This will demonstrate a “normal” submit process<br>Create a button called “AJAX”. URL = javascript:onLovChange(‘P1500_EMPNO_SEC’);</p>
<p>I haven’t used this in production yet so their may be some changes that I add to the code. If you have any feedback please leave a comment.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.talkapex.com/2009/05/enhancing-apex-security/" data-id="ckmve0f38006w01o44xkzbj6n" class="article-share-link">Share</a>
      
        <a href="http://www.talkapex.com/2009/05/enhancing-apex-security/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/apex/" rel="tag">apex</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/security/" rel="tag">security</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-apex-interactive-reports-customize-wait_28" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/04/apex-interactive-reports-customize-wait_28/" class="article-date">
  <time datetime="2009-04-29T04:57:00.000Z" itemprop="datePublished">2009-04-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/04/apex-interactive-reports-customize-wait_28/">APEX Interactive Reports - Customize Wait Display Part 2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>APEX Interactive Reports - Custom Wait Display Part 2</p>
<p><span style="font-style:italic;">Note: If you’re using APEX 4.0 please see this post: <a href="http://www.talkapex.com/2010/08/apex-40-interactive-reports-customize.html">http://www.talkapex.com/2010/08/apex-40-interactive-reports-customize.html</a></span></p>
<p>A few weeks ago I wrote about customizing the default APEX IR wait logo: <a href="http://apex-smb.blogspot.com/2009/04/apex-interactive-reports-customize-wait.html" target="_blank" rel="noopener">http://apex-smb.blogspot.com/2009/04/apex-interactive-reports-customize-wait.html</a>. Here is the second part of that article which focuses on overwriting APEX’s  <span style="font-style:italic; font-weight:bold;">dispIRBusyGraphics</span> function.</p>
<p>Overriding the default “Busy Graphic” function can be used to customize messages/images as well as preventing users from resubmitting IR request which may take a long time.</p>
<p>An example of this can be found <a href="http://apex.oracle.com/pls/otn/f?p=20195:1400" target="_blank" rel="noopener">here</a></p>
<p><span style="font-weight:bold;">- 1: Create IR Report</span></p>
<pre class="brush: sql">
-- Trying to make this a slow query to demonstrate the IR loader
SELECT     e.*, sum(e.sal) over() test
      FROM emp e
CONNECT BY LEVEL <= 5
</pre>

<p><span style="font-weight:bold;">- 2: Download jQuery and Simple Modal and upload the JavaScript files in the Application’s Static Files:</span></p>
<p>jQuery: <a href="http://jquery.com/" target="_blank" rel="noopener">http://jquery.com/</a><br>Simple Modal: <a href="http://www.ericmmartin.com/projects/simplemodal/" target="_blank" rel="noopener">http://www.ericmmartin.com/projects/simplemodal/</a></p>
<p><span style="font-weight:bold;">- 3: Create an HTML region and add the following:</span></p>
<pre class="brush: html">
<script src="#APP_IMAGES#jquery-1.3.2.min.js" type="text/javascript"></script>
<script src="#APP_IMAGES#jquery.simplemodal-1.2.3.js" type="text/javascript"></script>
<script type="text/javascript">
/**
 * @param pRegionStaticId ID of region to set to modal
 * @param pOptions Options for modal Screen. See: http://www.ericmmartin.com/projects/simplemodal/#options for more info
 */
goModal=function(pRegionStaticId, pOptions){
  var vDefaults = {persist: true, overlayCss: {backgroundColor: '#606060'}}; // Note: It's important that you leave the persist = true otherwise items values will be cleared

  pOptions = jQuery.extend(true,vDefaults, pOptions);

  // To maintain order of APEX items (see forum posting above
  $('#' + pRegionStaticId).wrap('<div></div>');

  // Make sure the region is visible
  $('#' + pRegionStaticId).show();

  // Open Modal Screen
  $('#' + pRegionStaticId).modal(pOptions);  
}// goModal

/**
 * Closes the modal screen
 */
modalClose=function(){
  $.modal.close();
}// modalClose

// OnLoad tasks
$(document).ready(function(){
  // Only apply if IR are present for page
  if ($('.apexir_WORKSHEET_DATA').length > 0) {
    // See apex_ns_3_1.js for _BusyGraphic
    function dispIRBusyGraphics(pState){
      if(pState == 1){
        // Here apexir_LOADER is the object ID. You can use your own region if you wanted to etc...
     goModal('apexir_LOADER', {position:['30%',]});
    }
    else{
          modalClose();
      }
    return;
    }// dispIRBusyGraphics

    function updateIRJS(){
     // This time out is required since after the report is refreshed via AJAX, need to reattach the l_LastFunction command
     setTimeout(
       function(){
        gReport._BusyGraphic = function(pState){dispIRBusyGraphics(pState);};
       },
       1000
      );
    }

    gReport = new apex.worksheet.ws('');
    gReport.l_LastFunction = function(){dispIRColGroups();}
    // Need to put timeout since not registering on initialization
    setTimeout(function(){gReport._BusyGraphic = function(pState){dispIRBusyGraphics(pState);};},500);
    updateIRJS();
  } //If IR exist
});
</script>

</pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.talkapex.com/2009/04/apex-interactive-reports-customize-wait_28/" data-id="ckmve0f2y006m01o4gaj94awe" class="article-share-link">Share</a>
      
        <a href="http://www.talkapex.com/2009/04/apex-interactive-reports-customize-wait_28/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/apex/" rel="tag">apex</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-presenting-at-coug-calgary-oracle-user" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/04/presenting-at-coug-calgary-oracle-user/" class="article-date">
  <time datetime="2009-04-21T02:16:00.000Z" itemprop="datePublished">2009-04-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/04/presenting-at-coug-calgary-oracle-user/">Presenting at COUG (Calgary Oracle User Group) May 28th</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://www.coug.ab.ca" target="_blank" rel="noopener"><img src="http://3.bp.blogspot.com/_33EF80fk9sM/Se0s5CljYQI/AAAAAAAADoQ/Jee6bufuoSQ/s400/coug.jpg" alt=""></a><br>I’ll be giving a presentation on APEX at the Calgary Oracle User Group (COUG) on May 28th at 8:00 am. For those of you in Calgary it will be at 17 B/C on the 17th floor of the Petro-Canada west tower (Corner of 1st and 6th ave).</p>
<p>Please see <a href="http://www.coug.ab.ca" target="_blank" rel="noopener">www.coug.ab.ca</a> for more information.</p>
<p>I’ll post a reminder a week before the presentation.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.talkapex.com/2009/04/presenting-at-coug-calgary-oracle-user/" data-id="ckmve0f2n006g01o4gmzf4a1u" class="article-share-link">Share</a>
      
        <a href="http://www.talkapex.com/2009/04/presenting-at-coug-calgary-oracle-user/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-custom-download-for-apex-interactive" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/04/custom-download-for-apex-interactive/" class="article-date">
  <time datetime="2009-04-20T13:44:00.000Z" itemprop="datePublished">2009-04-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/04/custom-download-for-apex-interactive/">Custom Download for APEX Interactive Reports</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>A few months ago I needed to modify the downloaded Interactive Report (IR) to CSV function so that we could include group headings, report description, and report parameters (please see <a href="http://apex-smb.blogspot.com/2009/03/column-groups-in-apex-interactive.html" target="_blank" rel="noopener">Column Groups in APEX Interactive Reports</a> on how to display column groups in IR). <a href="http://deneskubicek.blogspot.com/" target="_blank" rel="noopener">Denes Kubicek</a> has a package to download regular reports in Excel format, however it does not return the query that the user is currently viewing. This is really important since users may add columns, change the ordering of columns, etc. When users download a report it should reflect what is currently being displayed on the screen.</p>
<p>After digging through the APEX packages I was able to write some code to generate my own custom download function for IRs. Since the code is fairly long you’ll need to get a copy of the code <a href="http://apex.oracle.com/pls/otn/f?p=20195:1300" target="_blank" rel="noopener">here</a> (please save the file as pkg_apex_report.zip). <span style="font-weight:bold; color: red">Note: This code is NOT ready for a production environment!</span>. It’s also important to note that some of the grant privileges could have <span style="font-weight:bold; color: red">security implications</span> and is not recommend to be run for public applications. If you need to use these grants in a production instance I suggest creating a special “APEX” schema and write some custom wrapper functions. Since grants are required from the APEX schema I can’t post a working example of this application on <a href="http://apex.oracle.com" target="_blank" rel="noopener">apex.oracle.com</a>.</p>
<p>Now that I’m done with my disclaimers here’s how to customize IR downloads (don’t forget to download the code). <span style="font-style:italic;">Please note that the schema I developed in this was called “giffy”.</span></p>
<p><span style="font-weight:bold;">1- Grant Privileges</span></p>
<pre class="brush: sql">
  -- Change "apex_030200" to the version of APEX that you are using
  -- Change "giffy" to your schema
  GRANT EXECUTE ON apex_030200.wwv_flow_worksheet_standard TO giffy;
  CREATE OR REPLACE SYNONYM giffy.wwv_flow_worksheet_standard FOR apex_030200.wwv_flow_worksheet_standard

  GRANT EXECUTE ON apex_030200.wwv_flow_conditions TO giffy;
  CREATE OR REPLACE SYNONYM giffy.wwv_flow_conditions FOR apex_030200.wwv_flow_conditions;

  GRANT EXECUTE ON apex_030200.wwv_flow_worksheet TO giffy;
  CREATE OR REPLACE SYNONYM giffy.wwv_flow_worksheet FOR apex_030200.wwv_flow_worksheet;

  GRANT EXECUTE ON apex_030200.wwv_flow_render_query TO giffy;
  CREATE OR REPLACE SYNONYM giffy.wwv_flow_render_query FOR apex_030200.wwv_flow_render_query;
</pre>

<p><span style="font-weight:bold;">2- Create Package apex_report</span></p>
<p>Download code <a href="http://apex.oracle.com/pls/otn/f?p=20195:1300" target="_blank" rel="noopener">here</a> (save the file as pkg_apex_report.zip)<br>In SQL*Plus run:</p>
<pre class="brush: sql">
  @pkg_apex_report.pks
  @pkg_apex_report.pkb
</pre>

<p><span style="font-weight:bold;">3- Create Interactive Report region</span></p>
<pre class="brush: sql">
  SELECT *
    FROM emp
</pre>

<p><span style="font-weight:bold;">4- Create “Download Page”</span></p>
<ul>
<li><p>Create a new HTML Page.</p>
</li>
<li><p>Create a page item P3_BASE_REPORT_ID</p>
</li>
<li><p>Create a page item P3_PAGE_ID</p>
</li>
<li><p>Create a PL/SQL Process</p>
<ul>
<li>Point: On Load Before Header</li>
<li>PL/SQL:</li>
</ul>
</li>
</ul>
<pre class="brush: sql">
  DECLARE
    v_region_id apex_application_page_regions.region_id%TYPE;
    v_base_report_id apex_application_page_ir_rpt.base_report_id%TYPE;
    v_page_id apex_application_page_ir_rpt.page_id%TYPE;
  BEGIN
    v_base_report_id := :p3_base_report_id;
    v_page_id := :p3_page_id;

    SELECT ir.region_id
      INTO v_region_id
      FROM apex_application_page_ir_rpt irr,
           apex_application_page_ir ir
     WHERE irr.application_id = :app_id
       AND irr.page_id = v_page_id
       AND irr.session_id = :app_session
       AND irr.base_report_id = v_base_report_id
       AND irr.interactive_report_id = ir.interactive_report_id;

    pkg_apex_report.sp_download_report (p_page_id            => v_page_id,
                                        p_region_id          => v_region_id,
                                        p_base_report_id     => v_base_report_id,
                                        p_format_typ         => 'CSV'
                                       );
  END;
</pre>

<p><span style="font-weight:bold;">5- Alter Interactive Report Download Link</span><br><span style="font-style:italic;">Please see <a href="http://apex-smb.blogspot.com/2009/03/interactive-report-download-with-one.html" target="_blank" rel="noopener">APEX Interactive Report - Download with One Click</a> for more information about this code</span>. You’ll need <a href="http://www.jquery.com" target="_blank" rel="noopener">jQuery</a> for this.</p>
<pre class="brush: js">
//Note: "3" is my download page
$(document).ready(function() {
  $('.dhtmlSubMenuN[title="Download"]').attr('href','f?p=' + $v('pFlowId') + ':3:' + $v('pInstance') + '::NO:3:P3_PAGE_ID,P3_BASE_REPORT_ID:' + $v('pFlowStepId') + ',' + $v('apexir_REPORT_ID'));  
});
</pre>

<p>At this point you should be able to run your interactive report and download the custom CSV file. You’ll notice that there’s a block of HTML that appears at the top of the CSV file. This is caused by the call (wwv_flow_worksheet.get_worksheet_report_query) to get the SQL the user is currently looking at. I don’t have a fix or a work around (if you know of one please post in comment section)</p>
<p>Please post any bugs, suggestions, or updates to the code as I’d like to create a production version for this code.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.talkapex.com/2009/04/custom-download-for-apex-interactive/" data-id="ckmve0f2w006k01o4bb3l9xeb" class="article-share-link">Share</a>
      
        <a href="http://www.talkapex.com/2009/04/custom-download-for-apex-interactive/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/apex/" rel="tag">apex</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-apex-interactive-reports-customize-wait" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/04/apex-interactive-reports-customize-wait/" class="article-date">
  <time datetime="2009-04-13T13:43:00.000Z" itemprop="datePublished">2009-04-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/04/apex-interactive-reports-customize-wait/">APEX Interactive Reports - Customize Wait Display Part 1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>We recently needed to change, and move, the default Interactive Report (IR) AJAX “Loading” image (spinning wheel):<br><a href="http://3.bp.blogspot.com/_33EF80fk9sM/SeNCCZQweaI/AAAAAAAADoA/25cGNbjO0ok/s1600-h/01_cust_ir_wait.bmp" target="_blank" rel="noopener"><img src="http://3.bp.blogspot.com/_33EF80fk9sM/SeNCCZQweaI/AAAAAAAADoA/25cGNbjO0ok/s400/01_cust_ir_wait.bmp" alt=""></a><br>  After some investigation they’re several things you can do depending on your requirements. A demo application is available <a href="http://apex.oracle.com/pls/otn/f?p=20195:1200" target="_blank" rel="noopener">here.</a></p>
<p><span style="font-weight: bold">Part 2 is here: <a href="http://apex-smb.blogspot.com/2009/04/apex-interactive-reports-customize-wait_28.html" target="_blank" rel="noopener">http://apex-smb.blogspot.com/2009/04/apex-interactive-reports-customize-wait_28.html</a></span></p>
<p>Before we go over the solution it’s important to review where the image is located and how it gets toggled on and off. The image is stored in a span region which is hidden by default. The code looks like this:</p>
<pre class="brush: html">
  <span style="" id="apexir_LOADER">
    ![](/i/ws/ajax-loader.gif)
  </span>
</pre>

<p>If you want to manually make it visible you can run the following code:</p>
<pre class="brush: js">
  $('#apexir_LOADER').show();
</pre>

<p>The JS code to toggle the image is stored in: apex_ns_3_1.js. You can view an uncompressed version of this file in your installation directory: apex_3.1.2\apex\images\javascript\uncompressed\apex_ns_3_1.js  To toggle the image, APEX calls the following JS function: apex.worksheet.ws._BusyGraphic  (We won’t be using this function in this post but I’ll do another posting on how we can use it for a completely customizable solution)</p>
<p>First Let’s build a IR page with the emp table:</p>
<pre class="brush: sql">
select *
from emp
connect by level <= 3
</pre>

<p>The easiest option is if all you need to do is change the image:</p>
<pre class="brush: js">
  $('#apexir_LOADER img')[0].src="#IMAGE_PREFIX#processing3.gif";
</pre>

<p><a href="http://2.bp.blogspot.com/_33EF80fk9sM/SeNCdmCqZNI/AAAAAAAADoI/y3d79iimB84/s1600-h/02_cust_ir_wait.bmp" target="_blank" rel="noopener"><img src="http://2.bp.blogspot.com/_33EF80fk9sM/SeNCdmCqZNI/AAAAAAAADoI/y3d79iimB84/s400/02_cust_ir_wait.bmp" alt=""></a></p>
<p>The new image, processing3.gif, is part of APEX as well. You can reference your own images if you’d like.</p>
<p>In Part 2 I’ll go over changing the actual function that shows and hides the loading image. This will give you complete control of the loading message.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.talkapex.com/2009/04/apex-interactive-reports-customize-wait/" data-id="ckmve0f2t006i01o4houh95w2" class="article-share-link">Share</a>
      
        <a href="http://www.talkapex.com/2009/04/apex-interactive-reports-customize-wait/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/apex/" rel="tag">apex</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-presenting-at-odtug-kaleidoscope-2009" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/04/presenting-at-odtug-kaleidoscope-2009/" class="article-date">
  <time datetime="2009-04-09T00:19:00.000Z" itemprop="datePublished">2009-04-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/04/presenting-at-odtug-kaleidoscope-2009/">Presenting at ODTUG Kaleidoscope 2009 - APEX</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://www.odtugkaleidoscope.com/?utm_source=speake" target="_blank" rel="noopener"><img src="http://www.odtugkaleidoscope.com/webbutton.jpg" alt=""></a><br>Frank Hoogendoorn and I will be presenting at the Application Express Symposium on Sunday at ODTUG Kaleidoscope 2009. Our presentation is called “<span style="font-weight:bold;">Getting the Ape out of APEX</span>“.</p>
<p>I attended ODTUG last year in New Orleans and was amazed with all the excellent APEX presentations, I’m sure this year will be even better. If you can only attend once conference this year and you are using, or interested in, APEX this is the conference to go to!</p>
<p>You can go to <a href="http://www.odtugkaleidoscope.com/?utm_source=speake" target="_blank" rel="noopener">www.odtugkaleidoscope.com</a> for more information and registration.</p>
<p>See you then.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.talkapex.com/2009/04/presenting-at-odtug-kaleidoscope-2009/" data-id="ckmve0f2f006a01o461in6n6g" class="article-share-link">Share</a>
      
        <a href="http://www.talkapex.com/2009/04/presenting-at-odtug-kaleidoscope-2009/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kscope/" rel="tag">kscope</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-log-apex-interactive-report-search" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/04/log-apex-interactive-report-search/" class="article-date">
  <time datetime="2009-04-01T13:22:00.000Z" itemprop="datePublished">2009-04-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/04/log-apex-interactive-report-search/">Log APEX Interactive Report Search Filter</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>A few days ago someone posted a question on the forums <a href="http://forums.oracle.com/forums/message.jspa?messageID=3365707" target="_blank" rel="noopener">http://forums.oracle.com/forums/message.jspa?messageID=3365707</a> asking how to log the search filter in an IR. Here’s how to do it. A working example is available <a href="http://apex.oracle.com/pls/otn/f?p=20195:1100" target="_blank" rel="noopener">here.</a></p>
<p><span style="font-style:italic;">Please note you will need <a href="http://www.jquery.com" target="_blank" rel="noopener">jQuery</a> for this example</span></p>
<p><span style="font-weight:bold;">Step 1: Create Log Table</span></p>
<pre class="brush: sql">
  CREATE TABLE tir_search_filter_log(
    search_filter VARCHAR2(255) NULL,
    search_date DATE DEFAULT SYSDATE NOT NULL,
    username VARCHAR2(255) NOT NULL);
</pre>
<p><span style="font-weight:bold;">Step 2: Create Application Process</span></p>
<p>Create an On Demand Application Process. Call it: AP_LOG_SEARCH_FILTER</p>
<pre class="brush: sql;">
  BEGIN
    INSERT INTO tir_search_filter_log
                (search_filter,
                 search_date,
                 username
                )
    VALUES      (apex_application.g_x01,
                 SYSDATE,
                 :app_user
                );
  END;
</pre>
<p><span style="font-weight:bold;">Step 3: Create Interactive Report</span></p>
<p>Create a IR Page</p>
<pre class="brush: sql;">
  SELECT *
  FROM   emp
</pre>
<p><span style="font-weight:bold;">Step 3: Javascript</span></p>
<p>Create a HTML region and add the following javascript code:</p>
<pre class="brush: js;">
  // Function to call our Application Process to log the search
  function fLogSearch(){
    var get = new htmldb_Get(null,$v('pFlowId'),'APPLICATION_PROCESS=AP_LOG_SEARCH_FILTER',$v('pFlowStepId'));    
    get.addParam('x01',$v('apexir_SEARCH')); // IR Search Filter Value
    gReturn = get.get();  // Call AP Log Search Filter to insert log
    // Call APEX IR Search
    gReport.search('SEARCH');
  }

  // Run the following once the document is ready
  $(document).ready(function(){  
    // -- Handle Go Button --
    // Unbind all events. Important for order of execution
    $('input[type="button"][value="Go"]').attr('onclick',''); //unbind click event
    // Rebind events
    $('input[type="button"][value="Go"]').click(function(){fLogSearch()});

    // -- Handle "Enter" in input field --
    $('#apexir_SEARCH').attr('onkeyup',''); //unbind onkeyup event
    // Rebind Events
    $('#apexir_SEARCH').keyup(function(event){($f_Enter(event))?fLogSearch():null;});
  });
</pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.talkapex.com/2009/04/log-apex-interactive-report-search/" data-id="ckmve0f2m006e01o45tg050jl" class="article-share-link">Share</a>
      
        <a href="http://www.talkapex.com/2009/04/log-apex-interactive-report-search/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/apex/" rel="tag">apex</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-column-groups-in-apex-interactive" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/03/column-groups-in-apex-interactive/" class="article-date">
  <time datetime="2009-03-26T03:19:00.000Z" itemprop="datePublished">2009-03-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/03/column-groups-in-apex-interactive/">Column Groups in APEX Interactive Reports</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><span style="font-style:italic;color:red;">Note: If you are using APEX 4.0 I’ve developed a plugin for this: <a href="http://www.talkapex.com/2010/12/column-groups-in-apex-40-interactive.html">http://www.talkapex.com/2010/12/column-groups-in-apex-40-interactive.html</a></span></p>
<p>A while ago <a href="http://dgielis.blogspot.com/" target="_blank" rel="noopener">Dimitri Gielis</a> helped us to display column groups in Interactive Reports (IR) in APEX. Please see his <a href="http://dgielis.blogspot.com/2008/11/group-headings-in-interactive-report.html" target="_blank" rel="noopener">blog posting</a> to get a background of how to enable column groups in Interactive Reports.  </p>
<p><a href="http://2.bp.blogspot.com/_33EF80fk9sM/Scr2OYNUyNI/AAAAAAAADn4/GAaBwZhU9tM/s1600-h/01_ir_col_grp.bmp" target="_blank" rel="noopener"><img src="http://2.bp.blogspot.com/_33EF80fk9sM/Scr2OYNUyNI/AAAAAAAADn4/GAaBwZhU9tM/s400/01_ir_col_grp.bmp" alt=""></a></p>
<p>After some testing we’ve made several changes to the code. The updated code fixes a bug that would display multiple group headers. It does not load the group headers via AJAX so it speeds up response time. I’ve included the updated code below. The example of this is <a href="http://apex.oracle.com/pls/otn/f?p=20195:1000" target="_blank" rel="noopener">here.</a></p>
<p><span style="font-style: italic;">Please note you will need <a href="http://www.jquery.com" target="_blank" rel="noopener">jQuery</a> for this example</span></p>
<p><span style="font-weight:bold;">Step 1: Application Process</span><br>Create an Application Process to load the IR colum group header information<br>Name: AP_GET_IR_COL_GROUPS<br>Point: On Load: After Header (page template header)</p>
<pre class="brush: sql;">
DECLARE
  v_sql                         VARCHAR2 (500);
  v_count                       PLS_INTEGER;
BEGIN
  -- Need to ensure at least 1 col group exists
  SELECT COUNT (column_group_id)
  INTO   v_count
  FROM   apex_application_page_ir ir, apex_application_page_ir_col c
  WHERE  ir.application_id = :app_id
  AND    ir.page_id = :app_page_id   
  AND    ir.interactive_report_id = c.interactive_report_id;

-- Need to do join columns to IR rather than the page_id since columns that are added after IR was created need have a null page_id
  v_sql                      := '
SELECT c.column_alias,
       c.report_label,
       c.column_group
FROM   apex_application_page_ir_col c,
       apex_application_page_ir i
WHERE  i.application_id = :app_id
AND    i.page_id = :app_page_id
AND    i.interactive_report_id = c.interactive_report_id
AND    c.column_group IS NOT NULL';
  HTP.p ('<script type="text/javascript">');

  -- Only insert data if IR exists for this page
  IF v_count > 0 THEN
    -- Create JSON object. Note need to use htp.prn so line feed isn't sent
    HTP.prn ('var gPageIRColGrps = $u_eval(''(');
    apex_util.json_from_sql (v_sql);
    HTP.prn (')'');');
  ELSE
    HTP.p ('var gPageIRColGrp = '''';');
  END IF;

  HTP.p ('</script>');
END;
</pre>
<p><span style="font-weight:bold;">Step 2: Javascript Code</span><br>You can put this on Page 0 or just directly on the page with the Interactive Report</p>
<pre class="brush: js;">
dispIRColGrpHeader=function(){
  if(typeof(gPageIRColGrps) != "undefined"){
    // retrieve the Interactive report table
    var vTbl = $('.apexir_WORKSHEET_DATA');

    // change the look and feel of the IR table
    $(vTbl).attr("border","1");

    // Prevent Duplicate rows
    $('#irColGrpRow').remove();

    // Add the Column Group row
    $(vTbl[0].rows[0]).before('&lt;tr id="irColGrpRow"&gt;&lt;/tr&gt;');

    var vPrevColGrp = '';
    var vColGrpExists = false;
    var vColSpan = 1;
    // Loop over the row headers and see if we need to add a column group.
    for (var i = 0; i < $(vTbl[0].rows[1].cells).length; i++){
      // For IR, the column headers have divs with id of apexir
      vColId = '';
      // Only set the col ID if it exists (needed for IR row_id icon)
      if (typeof($('.apexir_WORKSHEET_DATA tr:eq(1) th:eq(' + i + ') div').attr('id')) != "undefined")
        vColId = $('.apexir_WORKSHEET_DATA tr:eq(1) th:eq(' + i + ') div').attr('id').replace(/apexir_/, '').toUpperCase();
      var vFoundColGrp = false; // This column has an associated column grp
      var vColGrp = ''; // Current Column group

      // Find the ID in the IR Groups global variable (genereated in AP)
      for (var j = 0; j < gPageIRColGrps.row.length; j ++ ){
        if (gPageIRColGrps.row[j].COLUMN_ALIAS.toUpperCase() == vColId) {
          vFoundColGrp = true;
          vColGrpExists = true;
          vColGrp = gPageIRColGrps.row[j].COLUMN_GROUP;
          break;
        }//if
      }// For IR Col Groups

      // Only print the col group header for the previous entry. This allows us to set the col span for similar groups
      // Have to do it this way to support IE  (otherwise we could look at the previous entry and update it's col span

      // If the current
      if (vColGrp.length > 0 && vColGrp == vPrevColGrp){
        // Don't display the
        vColSpan = vColSpan + 1;
      }
      else if(i > 0) {
        // Display the previous item
        $('#irColGrpRow').append('&lt;th colspan="' + vColSpan + '"&gt;' + vPrevColGrp + '&lt;/th&gt;');
        vColSpan = 1;
      }

      // If this is the last item then display it
      if (i == $(vTbl[0].rows[1].cells).length-1) {
        $('#irColGrpRow').append('&lt;th colspan="' + vColSpan + '"&gt;' + vColGrp + '&lt;/th&gt;');
      }

      vPrevColGrp = vColGrp;
    }// For each column being displayed

    // Remove the col group heading if no column groups:
    if (!vColGrpExists)
        $('#irColGrpRow').remove();
  } // Column groups exist

} // dispIRColGrpHeader

// Once the page is finsihed loading run the following (which will activate the column grouping display).
$(document).ready(function(){

// If page has an IR then set up for column grouping
  if ($('.apexir_WORKSHEET_DATA').length > 0) {

    function dispIRColGroups(){
      // Set the class for div hover since can't do in IE
      $('table.apexir_WORKSHEET_DATA th div').mouseover(function(){
        $(this).addClass('apexir_WORKSHEET_DATA_th_div_hover');
      });
      $('table.apexir_WORKSHEET_DATA th div').mouseout(function(){
        $(this).removeClass('apexir_WORKSHEET_DATA_th_div_hover');
      });  

     dispIRColGrpHeader();
     // This time out is required since after the report is refreshed via AJAX, need to reattach the l_LastFunction command
     setTimeout(
       function(){
        gReport.l_LastFunction = function(){dispIRColGroups();};
       },
       1000
      );
    }

    gReport = new apex.worksheet.ws('');
    gReport.l_LastFunction = function(){dispIRColGroups();}
    dispIRColGroups();
  }//if
});    
</pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.talkapex.com/2009/03/column-groups-in-apex-interactive/" data-id="ckmve0f2d006801o4cfnj2qpn" class="article-share-link">Share</a>
      
        <a href="http://www.talkapex.com/2009/03/column-groups-in-apex-interactive/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/apex/" rel="tag">apex</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-interactive-report-download-with-one" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/03/interactive-report-download-with-one/" class="article-date">
  <time datetime="2009-03-24T13:21:00.000Z" itemprop="datePublished">2009-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/03/interactive-report-download-with-one/">APEX Interactive Report - Download with One Click</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>We’ve been working with Interactive Reports (IR) over the past few months and have had to do a lot of customization to meet some of our customers requirements. Over the next few weeks my posts will be focused on these customizations.</p>
<p>To start, here’s an example of how to modify the download button in IRs. Just some background on this, we’re only supporting CSV downloads now. When the clients would download IRs they would have to click the “Download” link then click on the “CSV” button. <a href="http://1.bp.blogspot.com/_33EF80fk9sM/ScjenbChSKI/AAAAAAAADno/nM3A0JR76l4/s1600-h/01_csv_image.bmp" target="_blank" rel="noopener"><img src="http://1.bp.blogspot.com/_33EF80fk9sM/ScjenbChSKI/AAAAAAAADno/nM3A0JR76l4/s400/01_csv_image.bmp" alt=""></a></p>
<p>We found this extra step unnecessary so here’s a way on how to do it in one step so that it will download as soon as they click “Download”. We used <a href="http://www.jquery.com" target="_blank" rel="noopener">jQuery</a> to help out a bit. Here’s a working <a href="http://apex.oracle.com/pls/otn/f?p=20195:900" target="_blank" rel="noopener">example</a>.</p>
<pre class="brush: js;">
$(document).ready(function() {
  $('.dhtmlSubMenuN[title="Download"]').attr('href','f?p=' + $v('pFlowId') + ':' + $v('pFlowStepId') + ':' + $v('pInstance') + ':CSV:');  
});
</pre>

<p>Here’s a detailed summary of how it works: If you scroll over the “CSV” download button you’ll noticed that it looks something like : “f?p=102:3:207941080701500:CSV:”. If we break that down it’s really: “f?p=<APP_ID>:<APP_PAGE_ID>:<SESSION_ID>:CSV:”. In Javascript you can reference each as follows:</p>
<p>APP_ID = $v(‘pFlowId’);<br>APP_PAGE_ID = $v(‘pFlowStepId’);<br>SESSION_ID = $v(‘pInstance’);</p>
<p>Now to alter the “Download” link from the interactive report menu we use jQuery to identify the link: “$(‘.dhtmlSubMenuN[title=”Download”]’)” and then use the <a href="http://docs.jquery.com/Attributes/attr#keyvalue" target="_blank" rel="noopener">attr function</a> to set with the new URL.</p>
<script src="#APP_IMAGES#jquery-1.3.1.min.js" type="text/javascript"></script>
<script>  
$(document).ready(function() {
  $('.dhtmlSubMenuN[title="Download"]').attr('href','f?p=' + $v('pFlowId') + ':' + $v('pFlowStepId') + ':' + $v('pInstance') + ':CSV:');  
});
</script>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.talkapex.com/2009/03/interactive-report-download-with-one/" data-id="ckmve0f27006401o48aun82b3" class="article-share-link">Share</a>
      
        <a href="http://www.talkapex.com/2009/03/interactive-report-download-with-one/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/apex/" rel="tag">apex</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-custom-authentication-status" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/03/custom-authentication-status/" class="article-date">
  <time datetime="2009-03-22T16:27:00.000Z" itemprop="datePublished">2009-03-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/03/custom-authentication-status/">Custom Authentication Status</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>When writing custom authentication scheme I noticed that invalid logins weren’t showing up properly in the apex logs (apex_workspace_access_log).</p>
<p>Here’s how to re-create the problem along with the fix.</p>
<p>First let’s create a custom authentication function:</p>
<pre class="brush: sql;">
CREATE OR REPLACE FUNCTION blog_cust_auth (
  p_username IN VARCHAR2,
  p_password IN VARCHAR2
)
  RETURN BOOLEAN
AS
BEGIN
  IF     LOWER (p_username) = 'pass'
     AND LOWER (p_password) = '123' THEN
    RETURN TRUE;
  ELSE
    RETURN FALSE;
  END IF;
END;
</pre>
<p>Let’s set the APEX authentication scheme to use this custom function:</p>
<p>Shared Components / Authentication Schemes:</p>
<ul>
<li><p>Create</p>
</li>
<li><p>From Scratch</p>
</li>
<li><p>Name: BLOG_TEST</p>
</li>
<li><p>Keep hitting “Next” until:</p>
<ul>
<li>Credentials Verification Method:<ul>
<li>return blog_cust_auth</li>
</ul>
</li>
<li>Keep hitting “Next” until the end</li>
</ul>
</li>
<li><p>Change the current authentication scheme to BLOG_TEST</p>
<ul>
<li>On the Authentication Schemes page, on the right hand side select “Change Current” and select “BLOG_TEST’</li>
</ul>
</li>
</ul>
<p>Let’s create a region to always display the authentication statuses:</p>
<ul>
<li>Create Page<ul>
<li>Page Zero</li>
</ul>
</li>
<li>On Page 0 Create a region<ul>
<li>Report<pre class="brush: sql;">
SELECT   user_name,
     authentication_method,
     access_date,
     authentication_result,
     custom_status_text
FROM apex_workspace_access_log
WHERE application_id = :APP_ID
ORDER BY access_date DESC
</pre>
Now let’s try to log in using a valid username and password:</li>
</ul>
</li>
<li>username: pass, password: 123</li>
</ul>
<p>If things worked well you’re now on P1, and the “AUTHENITCATION_RESULT” is flagged as “AUTH_SUCCESS”</p>
<p><a href="http://3.bp.blogspot.com/_33EF80fk9sM/ScZntp_wliI/AAAAAAAADnQ/PRaOCMBcJsc/s1600-h/01_cust_auth_status.bmp" target="_blank" rel="noopener"><img src="http://3.bp.blogspot.com/_33EF80fk9sM/ScZntp_wliI/AAAAAAAADnQ/PRaOCMBcJsc/s400/01_cust_auth_status.bmp" alt=""></a></p>
<p>Now logout and try to login with invalid credentials</p>
<ul>
<li>username: pass, password: fail</li>
</ul>
<p>You’ll notice that the login failed, however it still logged it as a successful login attempt:</p>
<p><a href="http://3.bp.blogspot.com/_33EF80fk9sM/ScZn4N5ScYI/AAAAAAAADnY/T6KZdkpFqyE/s1600-h/02_cust_auth_status.bmp" target="_blank" rel="noopener"><img src="http://3.bp.blogspot.com/_33EF80fk9sM/ScZn4N5ScYI/AAAAAAAADnY/T6KZdkpFqyE/s400/02_cust_auth_status.bmp" alt=""></a></p>
<p>Let’s update our authentication function to use the 2 authentication result customizations:<br>apex_util.set_authentication_result and apex_util.set_custom_auth_status</p>
<pre class="brush: sql;">
CREATE OR REPLACE FUNCTION blog_cust_auth (
  p_username IN VARCHAR2,
  p_password IN VARCHAR2
)
  RETURN BOOLEAN
AS
BEGIN
  IF     LOWER (p_username) = 'pass'
     AND LOWER (p_password) = '123' THEN
    RETURN TRUE;
  ELSE
    -- Set APEX authentication Codes
    apex_util.set_authentication_result (p_code => 3);
    -- Set our own APEX custom text
    apex_util.set_custom_auth_status (p_status => 'Bad Username');
    RETURN FALSE;
  END IF;
END;
</pre>
<p>Let’s now see what happens when we now login with invalid credentials:</p>
<p><a href="http://3.bp.blogspot.com/_33EF80fk9sM/ScZoFSUVHOI/AAAAAAAADng/rusi5Cp0TTc/s1600-h/03_cust_auth_status.bmp" target="_blank" rel="noopener"><img src="http://3.bp.blogspot.com/_33EF80fk9sM/ScZoFSUVHOI/AAAAAAAADng/rusi5Cp0TTc/s400/03_cust_auth_status.bmp" alt=""></a></p>
<p>Notice that we now have proper error information in the logs? Here’s a list of some codes you can use for apex_util.set_authentication_result, taken from the view apex_workspace_access_log:</p>
<p>0, ‘AUTH_SUCCESS’,<br>1, ‘AUTH_UNKNOWN_USER’,<br>2, ‘AUTH_ACCOUNT_LOCKED’,<br>3, ‘AUTH_ACCOUNT_EXPIRED’,<br>4, ‘AUTH_PASSWORD_INCORRECT’,<br>5, ‘AUTH_PASSWORD_FIRST_USE’,<br>6, ‘AUTH_ATTEMPTS_EXCEEDED’,<br>7, ‘AUTH_INTERNAL_ERROR’,    </p>
<p>Of course you can use your own codes but I’d suggest sticking with these codes to utilize the APEX views. You can supplement the codes with the custom authentication status text (apex_util.set_custom_auth_status)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.talkapex.com/2009/03/custom-authentication-status/" data-id="ckmve0f25006201o4b0d4ee4a" class="article-share-link">Share</a>
      
        <a href="http://www.talkapex.com/2009/03/custom-authentication-status/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/apex/" rel="tag">apex</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/29/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="page-number" href="/page/29/">29</a><span class="page-number current">30</span><a class="page-number" href="/page/31/">31</a><a class="extend next" rel="next" href="/page/31/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title">Martin Giffy D'Souza</h3>
  <div class="widget aced">
    <img src="/images/profile-martin.jpg" alt="">&nbsp;&nbsp;<a href="http://goo.gl/IOHra" target="_blank" rel="noopener"><img src="/images/aced-logo.gif" alt="" /></a>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title">Links</h3>
  <div class="widget">
    <ul>
      <li><a id="sidebar-link-oos" href="https://github.com/oraopensource/" target="_blank">OraOpenSource</a></li>
      <li><a id="sidebar-link-podcast" href="http://apex.press/talkshow" target="_blank">Oracle APEX Podcast</a></li>
      <li><a id="sidebar-link-rss" href="/atom.xml">RSS Feed</a></li>
      <li><a id="sidebar-link-email" href="mailto:martin@talkapex.com">Email me</a></li>
      <li><a id="sidebar-link-twitter" href="https://twitter.com/martindsouza" target="_blank">Twitter</a></li>
      <li><a id="sidebar-link-linkedin" href="http://www.linkedin.com/in/martingiffydsouza" target="_blank">LinkedIn</a></li>
    </ul>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">Docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aop/" rel="tag">aop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apex/" rel="tag">apex</a><span class="tag-list-count">161</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apex-19/" rel="tag">apex-19</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apex-5/" rel="tag">apex-5</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apex-5-1/" rel="tag">apex-5.1</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apex-plugin/" rel="tag">apex-plugin</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/best-practice/" rel="tag">best-practice</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/checkbox/" rel="tag">checkbox</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chrome/" rel="tag">chrome</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design/" rel="tag">design</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dynamic-actions/" rel="tag">dynamic-actions</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/interactive-report/" rel="tag">interactive-report</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iot/" rel="tag">iot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/" rel="tag">jquery</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kscope/" rel="tag">kscope</a><span class="tag-list-count">21</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logger/" rel="tag">logger</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/macos/" rel="tag">macos</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/meta/" rel="tag">meta</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oci/" rel="tag">oci</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/odtug/" rel="tag">odtug</a><span class="tag-list-count">25</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oos-utils/" rel="tag">oos-utils</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oow/" rel="tag">oow</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/open-source/" rel="tag">open-source</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oracle/" rel="tag">oracle</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oracle-12c/" rel="tag">oracle-12c</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oracle-18c/" rel="tag">oracle-18c</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ords/" rel="tag">ords</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/plsql/" rel="tag">plsql</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/security/" rel="tag">security</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/" rel="tag">sql</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql-data-modeler/" rel="tag">sql-data-modeler</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql-developer/" rel="tag">sql-developer</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlcl/" rel="tag">sqlcl</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlplus/" rel="tag">sqlplus</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tabular-form/" rel="tag">tabular-form</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>


  
    <div class="widget-wrap">
  <h3 class="widget-title">Books</h3>
  <div class="widget">
    <table class="books">
      <tbody>
        <tr>
          <td><img src="/images/book-apex-plugins.jpeg" alt=""></td>
          <td><img src="/images/book-expert-apex-5.jpeg" alt=""></td>
        </tr>
        <tr>
          <td><a href="http://goo.gl/089zi" target="_blank" rel="noopener">APEX Plugins</a></td>
          <td><a href="http://bit.ly/talkapex-book-expert-2nd-ed" target="_blank" rel="noopener">Expert APEX 5</a></td>
        </tr>
        <tr>
          <td><img src="/images/book-begin-apex-4.jpeg" alt=""></td>
          <td><img src="/images/book-expert-apex-4.jpeg" alt=""></td>
        </tr>
        <tr>
          <td><a href="http://goo.gl/NxHoF" target="_blank" rel="noopener">Beginning APEX 4</a></td>
          <td><a href="http://goo.gl/tXm3P" target="_blank" rel="noopener">Expert APEX 4</a></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">2017</a><span class="archive-list-count">22</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/">2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/">2015</a><span class="archive-list-count">35</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/">2014</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/">2013</a><span class="archive-list-count">35</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/">2012</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/">2011</a><span class="archive-list-count">27</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/">2010</a><span class="archive-list-count">40</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/">2009</a><span class="archive-list-count">51</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/">2008</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Martin Giffy D&#39;Souza<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'talkapex';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-8016477-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




  </div>
</body>
</html>